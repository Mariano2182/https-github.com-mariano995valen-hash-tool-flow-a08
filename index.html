<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>RMM STRUCTURES | Plataforma BIM</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link
    href="https://fonts.googleapis.com/css2?family=Manrope:wght@300;400;600;700;800&display=swap"
    rel="stylesheet"
  />

  <link rel="stylesheet" href="styles.css" />

  <!-- Three.js + Controls (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/examples/js/controls/OrbitControls.js"></script>

  <!-- Supabase (opcional) -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <script src="script.js" defer></script>
</head>

<body>
  <header class="hero" id="home">
    <nav class="top-nav">
      <div class="logo">RMM STRUCTURES</div>
      <div class="nav-links">
        <a href="#plataforma">Plataforma</a>
        <a href="#configurador">Configurador 3D</a>
        <a href="#reglas">Reglas</a>
        <a href="#backend">Backend</a>
        <button class="primary" data-action="open-demo">Solicitar demo</button>
      </div>
    </nav>

    <div class="hero-content">
      <div>
        <p class="eyebrow">BIM + Ingeniería estructural + Fabricación inteligente</p>
        <h1>Diseñá y presupuestá naves industriales desde la web.</h1>
        <p class="lead">
          Un MVP que simula el flujo completo: wizard → modelo 3D → BOM → costo → export.
          En la siguiente etapa se conecta a Supabase para versionado real.
        </p>

        <div class="cta-row">
          <button class="primary" data-action="scroll" data-target="#configurador">Probar configurador</button>
          <button class="ghost" data-action="scroll" data-target="#backend">Ver roadmap</button>
        </div>

        <div class="hero-metrics">
          <div><strong>3D</strong><span>Modelo paramétrico</span></div>
          <div><strong>BOM</strong><span>Listado automático</span></div>
          <div><strong>CSV</strong><span>Export inmediato</span></div>
          <div><strong>v0</strong><span>MVP demostrable</span></div>
        </div>
      </div>

      <div class="hero-panel">
        <div class="panel-header">
          <span>Panel rápido</span>
          <span class="status">MVP listo</span>
        </div>
        <ul class="bullets">
          <li>Wizard de nave (tipo Optinave)</li>
          <li>Visor 3D con parámetros en vivo</li>
          <li>Tabla derecha: longitud, peso, piezas</li>
          <li>Costeo preliminar y export CSV/TXT</li>
        </ul>
        <button class="ghost" data-action="scroll" data-target="#configurador">Abrir configurador</button>
      </div>
    </div>
  </header>

  <main>
    <section id="plataforma" class="section alt">
      <div class="section-title">
        <h2>Plataforma (visión del producto)</h2>
        <p>
          Este MVP se enfoca en la experiencia y el flujo vendible. Luego se integra cálculo,
          export IFC real, uniones y CNC.
        </p>
      </div>

      <div class="grid-two">
        <article class="card">
          <h3>Roles (demo)</h3>
          <p>Simulamos permisos según rol, sin backend todavía.</p>

          <form id="auth-form" class="auth-form">
            <label>
              Email
              <input type="email" id="auth-email" placeholder="usuario@empresa.com" required />
            </label>

            <label>
              Rol
              <select id="auth-role">
                <option value="Cliente">Cliente</option>
                <option value="Ingeniero">Ingeniero</option>
                <option value="Fabricador">Fabricador</option>
                <option value="Admin">Admin</option>
              </select>
            </label>

            <div class="button-row">
              <button class="primary" type="submit">Iniciar sesión (demo)</button>
              <button class="ghost" type="button" data-action="logout">Cerrar sesión</button>
            </div>

            <div class="button-row">
              <button class="ghost" type="button" data-action="magic-link">Enviar magic link (Supabase)</button>
            </div>

            <p class="helper" id="auth-status">Sin sesión activa.</p>
            <p class="helper" id="auth-supabase-status">Supabase sin configurar.</p>
          </form>
        </article>

        <article class="card">
          <h3>Permisos activos</h3>
          <ul id="auth-permissions" class="permissions-list"></ul>
        </article>
      </div>
    </section>

    <!-- ✅ SECCIÓN ESTILO OPTINAVE -->
    <section id="configurador" class="section">
      <div class="section-title">
        <h2>Configurador 3D de nave (tipo Optinave)</h2>
        <p>
          Panel izquierdo: parámetros. Centro: visor 3D. Panel derecho: cantidades, longitudes y peso.
        </p>
      </div>

      <div class="configurator">
        <!-- LEFT -->
        <aside class="panel panel-left">
          <h3>Parámetros</h3>

          <div class="control">
            <label>Tipo de cubierta</label>
            <select id="roofType">
              <option value="2aguas">Dos aguas</option>
              <option value="1agua">Una agua</option>
            </select>
          </div>

          <div class="control">
            <label>Luz (m): <strong id="spanOut">24</strong></label>
            <input id="span" type="range" min="10" max="50" step="1" value="24" />
          </div>

          <div class="control">
            <label>Longitud (m): <strong id="lengthOut">40</strong></label>
            <input id="length" type="range" min="20" max="120" step="1" value="40" />
          </div>

          <div class="control">
            <label>Altura columnas (m): <strong id="colHOut">4.5</strong></label>
            <input id="colH" type="range" min="3" max="10" step="0.1" value="4.5" />
          </div>

          <div class="control">
            <label>Altura techo (m): <strong id="roofHOut">2</strong></label>
            <input id="roofH" type="range" min="0" max="6" step="0.1" value="2" />
          </div>

          <div class="control">
            <label>Cantidad pórticos: <strong id="framesOut">8</strong></label>
            <input id="frames" type="range" min="3" max="20" step="1" value="8" />
          </div>

          <div class="control">
            <label>Acero</label>
            <select id="steel">
              <option value="S275">S275</option>
              <option value="S355">S355</option>
            </select>
          </div>

          <div class="button-row">
            <button class="primary" data-action="rebuild">Recalcular modelo</button>
            <button class="ghost" data-action="export-bom">Exportar BOM (CSV)</button>
          </div>

          <p class="helper" id="cfgStatus">Listo.</p>
        </aside>

        <!-- CENTER -->
        <section class="panel panel-center">
          <div class="canvas-wrap">
            <canvas id="scene"></canvas>
          </div>
          <div class="center-actions">
            <button class="ghost" data-action="reset-camera">Reset cámara</button>
            <button class="ghost" data-action="toggle-grid">Grilla</button>
          </div>
        </section>

        <!-- RIGHT -->
        <aside class="panel panel-right">
          <h3>Resumen</h3>

          <div class="summary-box" id="summaryBox">
            <div class="kpi">
              <span>Pórticos</span><strong id="kpiFrames">8</strong>
            </div>
            <div class="kpi">
              <span>Longitud total</span><strong id="kpiLen">40 m</strong>
            </div>
            <div class="kpi">
              <span>Peso estimado</span><strong id="kpiWeight">-</strong>
            </div>
          </div>

          <h4>Elementos</h4>
          <div class="table-scroll">
            <table class="data-table">
              <thead>
                <tr>
                  <th>Elemento</th>
                  <th>Cant.</th>
                  <th>Longitud</th>
                  <th>Peso</th>
                </tr>
              </thead>
              <tbody id="elementsTable"></tbody>
            </table>
          </div>

          <h4>Costeo preliminar</h4>
          <div class="calculator">
            <label>Precio USD/kg
              <input type="number" id="priceKg" value="2.5" step="0.1" />
            </label>
            <label>Coef. fabricación
              <input type="number" id="coefFab" value="1.0" step="0.1" />
            </label>
            <label>Coef. montaje
              <input type="number" id="coefMont" value="0.15" step="0.01" />
            </label>
            <button class="primary" data-action="calc-cost">Calcular</button>
            <div class="summary-box" id="costBox">Sin cálculo.</div>
          </div>
        </aside>
      </div>
    </section>

    <section id="reglas" class="section alt">
      <div class="section-title">
        <h2>Motor de reglas (demo)</h2>
        <p>Validaciones básicas para consistencia y vendibilidad del flujo.</p>
      </div>

      <div class="grid-two">
        <article class="card">
          <button class="primary" data-action="run-rules">Ejecutar validaciones</button>
          <div class="summary-box" id="rulesSummary">Listo para validar.</div>
          <div id="rulesList" class="rules-list"></div>
        </article>

        <article class="card">
          <h3>Detalle</h3>
          <pre id="rulesDetail" class="codebox">Seleccioná una regla para ver detalles.</pre>
        </article>
      </div>
    </section>

    <section id="backend" class="section">
      <div class="section-title">
        <h2>Backend mínimo (Supabase)</h2>
        <p>
          Cuando el MVP ya tenga usuarios reales, activás guardado versionado con Auth y RLS.
        </p>
      </div>

      <div class="grid-two">
        <article class="card">
          <h3>Conexión Supabase (opcional)</h3>
          <label>Supabase URL
            <input type="url" id="sbUrl" placeholder="https://xxxx.supabase.co" />
          </label>
          <label>Anon Key
            <input type="password" id="sbKey" placeholder="eyJhbGciOi..." />
          </label>

          <div class="button-row">
            <button class="primary" data-action="sb-connect">Conectar</button>
            <button class="ghost" data-action="sb-save">Guardar versión</button>
            <button class="ghost" data-action="sb-load">Cargar última</button>
          </div>

          <p class="helper" id="sbStatus">Sin conexión.</p>
        </article>

        <article class="card">
          <h3>Versiones locales</h3>
          <div id="localVersions" class="versions"></div>
          <div class="button-row">
            <button class="primary" data-action="local-save">Guardar local</button>
            <button class="ghost" data-action="local-load">Cargar última</button>
          </div>
          <p class="helper" id="localStatus">Sin versiones.</p>
        </article>
      </div>
    </section>
  </main>

  <footer class="footer">
    <div>
      <h3>RMM STRUCTURES</h3>
      <p>Plataforma BIM para estructuras metálicas y fabricación industrial.</p>
    </div>
    <div class="footer-links">
      <a href="#home">Inicio</a>
      <a href="#configurador">Configurador</a>
      <a href="#reglas">Reglas</a>
      <a href="#backend">Backend</a>
    </div>
    <div class="footer-cta">
      <p>contacto@rmmstructures.com</p>
      <button class="ghost" data-action="open-demo">Solicitar demo</button>
    </div>
  </footer>

  <!-- Modal demo -->
  <div class="modal" id="demo-modal" aria-hidden="true">
    <div class="modal-content">
      <button class="modal-close" data-action="close-modal">×</button>
      <h2>Solicitar demo</h2>
      <p>Dejá tus datos y te mostramos el configurador con tu caso real.</p>

      <form id="demo-form" class="form">
        <label>
          Nombre
          <input type="text" name="name" required placeholder="Nombre y apellido" />
        </label>
        <label>
          Empresa
          <input type="text" name="company" required placeholder="Empresa" />
        </label>
        <label>
          Email
          <input type="email" name="email" required placeholder="correo@empresa.com" />
        </label>

        <button class="primary" type="submit">Enviar</button>
        <p class="form-status" id="demo-status">Completá para enviar.</p>
      </form>
    </div>
  </div>
</body>
</html>
